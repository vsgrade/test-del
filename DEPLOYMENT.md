
# Руководство по развертыванию CRM системы

## Автоматическая настройка при первом запуске

При первом запуске проекта автоматически откроется **Мастер настройки**, который проведет вас через все необходимые шаги.

### Шаг 1: Настройка базы данных

Выберите один из вариантов:

#### Вариант A: Supabase (рекомендуется)
1. Создайте проект на [supabase.com](https://supabase.com)
2. В разделе "Settings" → "API" скопируйте:
   - Project URL
   - Public anon key
3. Введите эти данные в мастере настройки

#### Вариант B: MySQL
1. Подготовьте MySQL сервер
2. Создайте базу данных для проекта
3. Введите данные подключения в мастере

### Шаг 2: Создание администратора

1. Введите данные администратора:
   - Email (по умолчанию: admin@example.com)
   - Пароль (по умолчанию: admin123) 
   - Имя и фамилию
2. **Важно:** Сохраните эти данные!

### Шаг 3: Завершение настройки

После успешной настройки вы автоматически войдете в систему.

## Ручная настройка (альтернативный способ)

Если мастер настройки не работает, можно настроить проект вручную:

### 1. Настройка переменных окружения

Для Supabase создайте файл с настройками в localStorage:

```javascript
localStorage.setItem('dbConfig', JSON.stringify({
  type: 'supabase',
  url: 'https://your-project.supabase.co',
  apiKey: 'your-anon-key'
}));

localStorage.setItem('projectInitialized', 'true');
```

### 2. Создание администратора

После настройки базы используйте страницу регистрации для создания первого пользователя.

## Развертывание на хостинге

### Vercel
1. Подключите GitHub репозиторий к Vercel
2. Разверните проект
3. При первом заходе пройдите мастер настройки

### Netlify
1. Подключите репозиторий к Netlify
2. Настройте build команды:
   - Build command: `npm run build`
   - Publish directory: `dist`
3. При первом заходе пройдите мастер настройки

### VPS/Dedicated сервер
1. Клонируйте репозиторий:
   ```bash
   git clone your-repo-url
   cd your-project
   ```

2. Установите зависимости:
   ```bash
   npm install
   ```

3. Соберите проект:
   ```bash
   npm run build
   ```

4. Настройте веб-сервер (nginx/apache) для раздачи статических файлов

5. При первом заходе пройдите мастер настройки

## Сброс настроек

Если нужно сбросить настройки проекта:

```javascript
localStorage.removeItem('projectInitialized');
localStorage.removeItem('dbConfig');
localStorage.removeItem('adminConfig');
```

После этого перезагрузите страницу - снова появится мастер настройки.

## Миграция данных

### Из другого проекта Supabase
1. Экспортируйте данные из старого проекта
2. Настройте новый проект через мастер
3. Импортируйте данные в новый проект

### Из MySQL в Supabase
1. Экспортируйте данные из MySQL
2. Настройте Supabase проект
3. Используйте SQL скрипты для импорта данных

## Безопасность

### Рекомендации по настройке Supabase
1. В настройках Supabase установите правильные URL:
   - Site URL: https://your-domain.com
   - Redirect URLs: https://your-domain.com/**

2. Настройте Row Level Security (RLS) политики

3. Отключите регистрацию новых пользователей после создания админа:
   - Authentication → Settings → "Enable email confirmations"

### Рекомендации по настройке MySQL
1. Используйте SSL соединения
2. Создайте отдельного пользователя для приложения
3. Ограничьте права доступа к необходимому минимуму

## Устранение неполадок

### Проблема: Мастер настройки не появляется
**Решение:** Очистите localStorage и перезагрузите страницу

### Проблема: Ошибка подключения к базе данных
**Решение:** 
1. Проверьте правильность введенных данных
2. Убедитесь, что база данных доступна
3. Проверьте настройки файрвола

### Проблема: Не удается создать администратора
**Решение:**
1. Проверьте настройки аутентификации в Supabase
2. Убедитесь, что email уникален
3. Проверьте требования к паролю

### Проблема: 404 ошибки в production
**Решение:** Настройте редиректы для SPA:
- Vercel: создайте `vercel.json` с правилами rewrite
- Netlify: создайте `_redirects` файл
- Nginx: настройте `try_files`

## Поддержка

При возникновении проблем:
1. Проверьте консоль браузера на ошибки
2. Убедитесь, что все настройки корректны
3. Перезапустите мастер настройки
4. Обратитесь к документации хостинг-провайдера
